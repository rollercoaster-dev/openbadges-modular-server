#!/usr/bin/env bash

# Check if eslint.config.js is being modified
if git diff --cached --name-only | grep -q "eslint.config.js"; then
  # Check if any rules are being weakened (changed from 'error' to 'warn' or 'off')
  if git diff --cached eslint.config.js | grep -E "^\+.*'(error|\"error)'" | grep -q -v "NEVER DISABLE"; then
    echo "✅ Adding new error rules is allowed"
  fi
  
  if git diff --cached eslint.config.js | grep -E "^\-.*'(error|\"error)'"; then
    echo "❌ ERROR: You are trying to remove or weaken ESLint error rules!"
    echo "This is not allowed. Please fix the code to comply with the rules instead."
    echo "If you believe this is a false positive, add a comment '// NEVER DISABLE' next to the rule."
    exit 1
  fi
  
  if git diff --cached eslint.config.js | grep -E "^\+.*'(warn|off|\"warn\"|\"off\")'"; then
    echo "❌ ERROR: You are trying to add weakened ESLint rules!"
    echo "This is not allowed. All rules should be set to 'error'."
    echo "If you believe this is a false positive, add a comment '// NEVER DISABLE' next to the rule."
    exit 1
  fi
fi

# Continue with the commit if no issues were found
exit 0
