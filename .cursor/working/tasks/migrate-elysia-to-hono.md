# Migration Task: Elysia.js â†’ Hono

## Objective
Refactor the OpenBadges Modular Server to use [Hono](https://hono.dev/) instead of Elysia.js for all API routing, middleware, and validation. Ensure functional parity, robust validation, and maintainable code.

---

## Migration Plan

### 1. Replace Elysia App/Server Instantiation
- Locate all Elysia instantiations (`new Elysia()`, `.listen`, etc.).
- Replace with `new Hono()` and Hono's listen/start method.
- Map Elysia plugins (CORS, helmet, etc.) to Hono or compatible middleware.
- Adjust for Bun/Node compatibility as needed.

### 2. Refactor Route Definitions and Controllers
- Convert chained/grouped Elysia routes to Hono's `app.METHOD(path, handler)` style.
- Update controller handlers to use Hono's context (`c.req`, `c.res`, `c.json()`, etc.).
- Refactor any use of `.group` or `.decorate` to Hono's modular router/app structure.
- Ensure all route parameters, responses, and error handling are preserved.

### 3. Migrate Middleware
- Map Elysia's `.use`, `.decorate`, `.onRequest`, `.onError`, `.onAfterResponse` to Hono's `app.use()` and `createMiddleware`.
- Reimplement context extension and request/response hooks using Hono idioms.
- Adapt error handling to Hono's middleware and handler error propagation.
- Implement after-response logic as custom middleware if needed.

### 4. Adapt Validation (Zod)
- Replace Elysia-integrated Zod validation with [`@hono/zod-validator`](https://github.com/honojs/zod-validator).
- Refactor validation middleware and error formatting to match Hono's patterns.
- Ensure all request/response validation is preserved and error responses are consistent.

### 5. Adjust Project Structure and Imports
- Remove Elysia-specific imports, plugins, and patterns.
- Update all imports to use Hono and its ecosystem.
- Refactor helpers/utilities tied to Elysia's context/lifecycle.
- Ensure all middleware, controllers, and routers are correctly integrated with Hono.

### 6. Update Tests and Scripts
- Refactor integration/e2e tests to use Hono's app instance/context.
- Update test utilities, mocks, and setup code.
- Update scripts (start, test, lint, etc.) to reflect Hono usage.
- Ensure CI/CD and local scripts are compatible with the new stack.

### 7. Review and Test
- Thoroughly test all routes, middleware, and error handling.
- Run linting and type checking to ensure code quality.
- Validate API contracts, schemas, and error responses for consistency.
- Document any deviations, limitations, or new patterns.

---

## Risks & Considerations
- Some Elysia plugins may not have direct Hono equivalents (custom logic may be required).
- Handler signatures and context access patterns will change; careful refactoring is needed.
- Validation error formatting/propagation may differ; custom error handlers may be needed.
- Some project utilities may have implicit Elysia dependencies; review thoroughly.
- Test helpers and integration tests may require significant refactoring.
- Subtle differences in request/response lifecycle or middleware order may cause regressions.

---

## References
- [Hono Documentation](https://hono.dev/)
- [@hono/zod-validator](https://github.com/honojs/zod-validator)
- [Elysia.js Documentation](https://elysiajs.com/)
- Context7 research (see codebase and migration notes)

---

## Next Steps
1. Review this plan and gather feedback.
2. Inventory all Elysia usages in the codebase.
3. Begin migration step-by-step, committing at logical milestones.
4. Maintain a changelog and document any new patterns or issues encountered.

---

*Generated by David, with sequential analysis and Context7-backed research.*
